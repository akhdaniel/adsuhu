<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="product_analysis_list_template" name="Product Analysis List">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <section class="adsuhu-container">
                    <div class="container">
                        <div class="adsuhu-header">
                            <h1>Product Value Analysis</h1>
                            <p class="lead">Explore our in-depth product value breakdowns and market insights.</p>
                            <a href="/product_analysis/create" class="btn btn-primary mt-3">
                                <i class="fa fa-plus"></i> Create New Analysis
                            </a>
                        </div>
                        
                        <div class="adsuhu-card-grid">
                            <t t-foreach="analyses" t-as="analysis">
                                <div class="adsuhu-card">
                                    <div class="adsuhu-card-body">
                                        <div class="adsuhu-card-meta">
                                            <i class="fa fa-calendar"></i>
                                            <span t-field="analysis.create_date" t-options='{"widget": "date"}'></span>
                                        </div>
                                        <h3 class="adsuhu-card-title">
                                            <a t-attf-href="/product_analysis/#{analysis.id}" t-field="analysis.name"></a>
                                        </h3>
                                        <div class="adsuhu-card-text" t-if="analysis.description">
                                            <t t-out="analysis.description[:200] + '...' if len(analysis.description) > 200 else analysis.description"/>
                                        </div>
                                        <div class="mt-auto pt-3">
                                            <a t-attf-href="/product_analysis/#{analysis.id}" class="adsuhu-btn-primary">
                                                View Analysis
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                        
                        <div class="d-flex justify-content-center mt-5">
                            <t t-call="website.pager"/>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <template id="product_analysis_detail_template" name="Product Analysis Detail">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="adsuhu-detail-header">
                    <div class="container">
                        <div class="text-center">
                            <h1 class="adsuhu-detail-title" t-field="analysis.name"></h1>
                            <p class="text-muted">
                                Created on <span t-field="analysis.create_date" t-options='{"widget": "date"}'></span>
                            </p>
                            <a href="/product_analysis" class="btn btn-outline-secondary mt-2">
                                <i class="fa fa-arrow-left"></i> Back
                            </a>
                            <a t-if="analysis.product_url" t-att-href="analysis.product_url" target="_blank" class="btn btn-outline-primary mt-2">
                                <i class="fa fa-external-link"></i> Visit Product URL
                            </a>
                            <a t-attf-href="/product_analysis/#{analysis.id}/edit" class="btn btn-outline-secondary mt-2 ms-2">
                                <i class="fa fa-pencil"></i> Edit
                            </a>
                            <a t-if="analysis.report_docx" t-attf-href="/web/content/vit.product_value_analysis/#{analysis.id}/report_docx/#{analysis.report_docx_filename or 'report.docx'}?download=true" class="btn btn-primary mt-2 ms-2">
                                <i class="fa fa-download"></i> Download DOCX
                            </a>
                        </div>
                    </div>
                </div>

                <div class="container adsuhu-container" id="main">
                    <input type="hidden" id="adsuhu-csrf-token" t-att-value="request.csrf_token()"/>
                    <div class="row">
                        <!-- TOC -->
                        <div class="col-lg-3 mb-4" id="toc">
                            <div class="adsuhu-toc" style="position: sticky; top: 6rem; max-height: calc(100vh - 6rem); overflow: auto;">
                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Product</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-description">
                                        <!-- descriptoion-->
                                        <t t-if="analysis.description">
                                            <li class="list-group-item p-0">
                                                <a class="list-group-item list-group-item-action border-0" href="#section-description">
                                                    Description
                                                </a>
                                            </li>
                                        </t>
                                        <!-- features-->
                                        <t t-if="analysis.features">
                                            <li class="list-group-item p-0">
                                                <a class="list-group-item list-group-item-action border-0" href="#section-features">
                                                    Features
                                                </a>
                                            </li>
                                        </t>

                                        <!-- product analys-->
                                        <li class="list-group-item p-0">
                                            <a class="list-group-item list-group-item-action border-0" href="#section-product-analysis">
                                                Product Analysis
                                            </a>
                                        </li>
                                    </ul>
                                </details>

                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Market Map</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-market-mapper">
                                        <!-- market mappers -->
                                        <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                            <li class="list-group-item p-0">
                                                <a class="list-group-item list-group-item-action border-0" t-attf-href="#section-market-#{market.id}">
                                                    <t t-out="market.name"/>
                                                </a>
                                            </li>
                                        </t>
                                    </ul>
                                </details>

                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Audience Profiles</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-audience-profiler">
                                        <!-- audience profiles-->
                                        <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                            <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                                <li class="list-group-item p-0">
                                                    <a class="list-group-item list-group-item-action border-0" t-attf-href="#section-audience-#{audience.id}">
                                                        <t t-out="audience.name"/>
                                                    </a>
                                                </li>
                                            </t>
                                        </t>
                                    </ul>
                                </details>

                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Angles</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-angle-hook">
                                        <!-- angle hook -->
                                        <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                            <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                                <li class="list-group-item p-0 adsuhu-toc-node">
                                                    <details>
                                                        <summary class="adsuhu-toc-summary">AP <t t-out="audience.audience_profile_no"/></summary>
                                                        <ul class="list-group">
                                                            <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                                                <li class="list-group-item p-0">
                                                                    <a class="list-group-item list-group-item-action border-0" t-attf-href="#section-angle-#{angle.id}">
                                                                        ANGLE <t t-out="angle.angle_no"/>
                                                                    </a>
                                                                </li>
                                                            </t>
                                                        </ul>
                                                    </details>
                                                </li>
                                            </t>
                                        </t>
                                    </ul>
                                </details>

                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Hooks</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-hook">
                                        <!--  hook -->
                                        <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                            <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                                <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                                    <li class="list-group-item p-0 adsuhu-toc-node">
                                                        <details>
                                                            <summary class="adsuhu-toc-summary">AP <t t-out="audience.audience_profile_no"/> - Angle <t t-out="angle.angle_no"/></summary>
                                                            <ul class="list-group">
                                                                <t t-foreach="angle.hook_ids" t-as="hook">
                                                                    <li class="list-group-item p-0">
                                                                        <a class="list-group-item list-group-item-action border-0" t-attf-href="#section-hook-#{hook.id}">
                                                                            HOOK <t t-out="hook.hook_no"/>
                                                                        </a>
                                                                    </li>
                                                                </t>
                                                            </ul>
                                                        </details>
                                                    </li>
                                                </t>
                                            </t>
                                        </t>
                                    </ul>
                                </details>

                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Ads Copy</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-ads-copy">
                                        <!-- ads copy -->
                                        <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                            <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                                <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                                    <t t-foreach="angle.hook_ids" t-as="hook">
                                                        <li class="list-group-item p-0 adsuhu-toc-node">
                                                            <details>
                                                                <summary class="adsuhu-toc-summary">AP <t t-out="audience.audience_profile_no"/> - Angle <t t-out="angle.angle_no"/> - Hook <t t-out="hook.hook_no"/></summary>
                                                                <ul class="list-group">
                                                                    <t t-foreach="hook.ads_copy_ids" t-as="ads">
                                                                        <li class="list-group-item p-0">
                                                                            <a class="list-group-item list-group-item-action border-0" t-attf-href="#section-ads-#{ads.id}">
                                                                                <t t-out="ads.name"/>
                                                                            </a>
                                                                        </li>
                                                                    </t>
                                                                </ul>
                                                            </details>
                                                        </li>
                                                    </t>
                                                </t>
                                            </t>
                                        </t>
                                    </ul>
                                </details>

                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Landing Pages</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-landing-pages">
                                        <!-- landing pages -->
                                        <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                            <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                                <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                                    <t t-foreach="angle.hook_ids" t-as="hook">
                                                        <li class="list-group-item p-0 adsuhu-toc-node">
                                                            <details>
                                                                <summary class="adsuhu-toc-summary">AP <t t-out="audience.audience_profile_no"/> - Angle <t t-out="angle.angle_no"/> - Hook <t t-out="hook.hook_no"/></summary>
                                                                <ul class="list-group">
                                                                    <t t-foreach="hook.ads_copy_ids" t-as="ads">
                                                                        <t t-foreach="ads.landing_page_builder_ids" t-as="lp">
                                                                            <li class="list-group-item p-0">
                                                                                <a class="list-group-item list-group-item-action border-0" t-attf-href="#section-lp-#{lp.id}">
                                                                                    <t t-out="ads.name"/>
                                                                                </a>
                                                                            </li>
                                                                        </t>
                                                                    </t>
                                                                </ul>
                                                            </details>
                                                        </li>
                                                    </t>
                                                </t>
                                            </t>
                                        </t>
                                    </ul>
                                </details>

                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Images</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-landing-pages">
                                        <!-- images -->
                                        <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                            <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                                <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                                    <t t-foreach="angle.hook_ids" t-as="hook">
                                                        <li class="list-group-item p-0 adsuhu-toc-node">
                                                            <details>
                                                                <summary class="adsuhu-toc-summary">AP <t t-out="audience.audience_profile_no"/> - Angle <t t-out="angle.angle_no"/> - Hook <t t-out="hook.hook_no"/></summary>
                                                                <ul class="list-group">
                                                                    <t t-foreach="hook.ads_copy_ids" t-as="ads">
                                                                        <t t-foreach="ads.image_generator_ids" t-as="img">
                                                                            <li class="list-group-item p-0">
                                                                                <a class="list-group-item list-group-item-action border-0" t-attf-href="#section-img-#{img.id}">
                                                                                    <t t-out="ads.name"/> - <t t-out="img.ads_copy_no"/>
                                                                                </a>
                                                                            </li>
                                                                        </t>
                                                                    </t>
                                                                </ul>
                                                            </details>
                                                        </li>
                                                    </t>
                                                </t>
                                            </t>
                                        </t>
                                    </ul>
                                </details>

                                <details class="adsuhu-toc-section" open="open">
                                    <summary class="adsuhu-toc-section-title">Videos</summary>
                                    <ul class="list-group adsuhu-toc-tree" id="list-landing-pages">
                                        <!-- videos -->
                                        <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                            <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                                <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                                    <t t-foreach="angle.hook_ids" t-as="hook">
                                                        <li class="list-group-item p-0 adsuhu-toc-node">
                                                            <details>
                                                                <summary class="adsuhu-toc-summary">AP <t t-out="audience.audience_profile_no"/> - Angle <t t-out="angle.angle_no"/> - Hook <t t-out="hook.hook_no"/></summary>
                                                                <ul class="list-group">
                                                                    <t t-foreach="hook.ads_copy_ids" t-as="ads">
                                                                        <t t-foreach="ads.video_director_ids" t-as="vid">
                                                                            <li class="list-group-item p-0">
                                                                                <a class="list-group-item list-group-item-action border-0" t-attf-href="#section-vid-#{vid.id}">
                                                                                    <t t-out="ads.name"/>
                                                                                </a>
                                                                            </li>
                                                                        </t>
                                                                    </t>
                                                                </ul>
                                                            </details>
                                                        </li>
                                                    </t>
                                                </t>
                                            </t>
                                        </t>
                                    </ul>
                                </details>

                            </div>
                        </div>

                        <!-- content -->
                        <div class="col-lg-9" id="content">
                            <h1>Product</h1>
                            <!-- description -->
                            <div id="section-description" style="scroll-margin-top: 6rem;">
                                <section class="adsuhu-section" >
                                    <h2 class="adsuhu-section-title">Description</h2>
                                    <t t-if="analysis.description">
                                        <div class="adsuhu-content" t-out="description_html"></div>
                                        <div t-if="not analysis.features" class="d-flex align-items-center justify-content-center">
                                            <button t-if="not analysis" class="btn btn-secondary js-regenerate" 
                                                id="generate_features" 
                                                t-att-data-id="analysis.id" 
                                                data-regenerate="features">
                                                <i class="fa fa-send me-1"></i> Rewrite Features
                                            </button>
                                        </div>
                                    </t>
                                </section>
                            </div>

                            <!-- features -->
                            <div id="section-features" style="scroll-margin-top: 6rem;">
                                <section class="adsuhu-section" >
                                    <h2 class="adsuhu-section-title">Features</h2>
                                    <t t-if="analysis.features">
                                        <div class="adsuhu-content" t-out="features_html"></div>

                                        <div class="d-flex align-items-center justify-content-center">
                                            <button t-if="not analysis.output_html" class="btn btn-secondary js-regenerate" 
                                                id="generate_product_value_analysis" 
                                                t-att-data-id="analysis.id" 
                                                data-regenerate="product_value_analysis"
                                                data-next-model="market_mapper"
                                                data-target-section="section-product-analysis"
                                            >
                                                <i class="fa fa-send me-1"></i> Analyze Product Value 
                                            </button>
                                        </div>
                                    </t>
                                </section>
                            </div>

                            <!-- product analysis -->
                            <div id="section-product-analysis" style="scroll-margin-top: 6rem;">
                                <section class="adsuhu-section" >
                                    <h2 class="adsuhu-section-title">Product Analysis</h2>
                                    <t t-if="analysis.output_html" >
                                        <div class="adsuhu-content" t-raw="analysis.output_html"></div>
                                        <div t-if="not analysis.market_mapper_ids" class="d-flex align-items-center justify-content-center">
                                            <button class="btn btn-secondary js-regenerate" 
                                                id="regenerate_market_mapper" 
                                                t-att-data-id="analysis.id" 
                                                data-regenerate="market_mapper"
                                                data-next-model="audience_profiler"
                                                data-target-section="section-market-mapper">
                                                <i class="fa fa-send me-1"></i> Analyze Market Map
                                            </button>
                                        </div>
                                    </t>
                                </section>
                            </div>

                            <h1>Market Mapper</h1>
                            <!-- market mappers-->
                            <div id="section-market-mapper" >
                                <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                    <section class="adsuhu-section" t-if="market.output_html" t-attf-id="section-market-#{market.id}" style="scroll-margin-top: 6rem;">
                                        <h2 class="adsuhu-section-title" t-field="market.name"></h2>
                                        <div class="adsuhu-content"  t-raw="market.output_html"></div>
                                        <div class="d-flex align-items-center justify-content-center">
                                            <button t-if="not market.audience_profiler_ids"  class="btn btn-secondary js-regenerate" 
                                                id="audience_profiler" 
                                                t-att-data-id="market.id" 
                                                data-regenerate="audience_profiler"
                                                data-next-model="angle_hoook"
                                                data-target-section="section-audience-profiler"
                                            >
                                                <i class="fa fa-send me-1"></i> Analyze Auidence Profile 
                                            </button>
                                        </div>
                                    </section>
                                </t>
                            </div>

                            <h1>Audience Profile</h1>
                            <!-- audience profile-->
                            <div id="section-audience-profiler" >
                                <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                    <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                        <section class="adsuhu-section" t-attf-id="section-audience-#{audience.id}" style="scroll-margin-top: 6rem;">
                                            <h2 class="adsuhu-section-title">AP <t t-out="audience.name"/></h2>
                                                
                                            <div class="adsuhu-content" t-if="audience.output_html" t-raw="audience.output_html"></div>
                                            <div class="d-flex align-items-center justify-content-center">
                                                <a class="btn btn-primary" t-attf-href="#section-market-#{market.id}">
                                                    <i class="fa fa-arrow-left me-1"></i> Back to Market Mapper
                                                </a>                                            
                                                <button t-if="not audience.angle_hook_ids" class="btn btn-secondary js-regenerate" 
                                                    id="regenerate_angles" 
                                                    t-att-data-id="audience.id" 
                                                    data-regenerate="angle_hook" 
                                                    data-next-model="hook"
                                                    data-target-section="section-angle-hook">
                                                    <i class="fa fa-send me-1"></i> Create Angles &amp; Hooks
                                                </button>

                                                <a t-attf-href="#audience-profile-angles-#{audience.id}" 
                                                    t-attf-id="view-angle_hook-#{audience.id}"
                                                    class="btn btn-primary" 
                                                    >View Angles &amp; Hooks
                                                </a>
                                            </div>
                                        </section>
                                    </t>
                                </t>
                            </div>

                            <h1>Angles</h1>
                            <!-- angles -->
                            <div id="section-angle-hook" style="scroll-margin-top: 6rem;">
                                <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                    <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                        <div t-attf-id="audience-profile-angles-#{audience.id}" style="scroll-margin-top: 6rem;">
                                            <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                                <section class="adsuhu-section" t-attf-id="section-angle-#{angle.id}" style="scroll-margin-top: 6rem;">
                                                    <h2 class="adsuhu-section-title">Angle: <t t-out="angle.name"/></h2>
                                                    <div class="adsuhu-content" t-raw="angle.output_html"></div>

                                                    <div class="d-flex align-items-center justify-content-center">
                                                        <a class="btn btn-primary" t-attf-href="#section-audience-#{audience.id}">
                                                            <i class="fa fa-arrow-left me-1"></i> Back to AP <t t-out="audience.audience_profile_no"/>
                                                        </a>
                                                        <a class="btn btn-primary" t-attf-href="#section-angle-hook-#{angle.id}">
                                                            <i class="fa fa-send me-1"></i> View Hooks
                                                        </a>
                                                    </div>
                                                </section>
                                            </t>
                                        </div>
                                    </t>
                                </t>
                            </div>

                            <h1>Hooks</h1>
                            <!-- hooks -->
                            <div id="section-hook" >
                                <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                    <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                        <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                            <div t-attf-id="section-angle-hook-#{angle.id}" style="scroll-margin-top: 6rem;">
                                                <t t-foreach="angle.hook_ids" t-as="hook">
                                                    <section class="adsuhu-section" t-attf-id="section-hook-#{hook.id}" style="scroll-margin-top: 6rem;">
                                                        <h2 class="adsuhu-section-title">Hook: <t t-out="hook.name"/></h2>
                                                        <div class="adsuhu-content" t-if="hook.output_html" t-raw="hook.output_html"></div>
                                                        
                                                        <div class="d-flex align-items-center justify-content-center">
                                                            <a t-attf-href="#section-angle-#{angle.id}" class="btn btn-primary">
                                                                <i class="fa fa-arrow-left me-1"></i> Back to Angle <t t-out="angle.angle_no"/>
                                                            </a>

                                                            <button 
                                                                t-if="not hook.ads_copy_ids" 
                                                                class="btn btn-secondary js-regenerate" 
                                                                id="ads_copy" 
                                                                t-att-data-id="hook.id" 
                                                                data-regenerate="ads_copy" 
                                                                data-target-section="section-ads-copy"
                                                            >
                                                                <i class="fa fa-send me-1"></i> Create Ads Copy
                                                            </button>

                                                            <a t-attf-id="view-ads_copy-#{hook.id}" 
                                                                t-attf-href="#hook-ads-copies-#{hook.id}" 
                                                                class="btn btn-primary"
                                                                t-attf-style="display: #{'block' if hook.ads_copy_ids else 'none'};"
                                                            >
                                                                View Ads Copies
                                                            </a>
     
                                                        </div>                                   
                                                    </section>
                                                </t>
                                            </div>
                                        </t>
                                    </t>
                                </t>
                            </div>

                            <h1>Ads Copy</h1>
                            <!-- ads copy -->
                            <div id="section-ads-copy" >
                                <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                    <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                        <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                            <t t-foreach="angle.hook_ids" t-as="hook">
                                                <div t-attf-id="hook-ads-copies-#{hook.id}" style="scroll-margin-top: 6rem;">
                                                    <t t-foreach="hook.ads_copy_ids" t-as="ads">
                                                        <section class="adsuhu-section" t-attf-id="section-ads-#{ads.id}" style="scroll-margin-top: 6rem;">
                                                            <h2 class="adsuhu-section-title">Ads Copy: <t t-out="ads.name"/></h2>
                                                            <div class="adsuhu-content" t-if="ads.output_html" t-raw="ads.output_html_trimmed"></div>

                                                            <div class="d-flex align-items-center justify-content-center">
                                                                <a class="btn btn-primary" t-attf-href="#section-hook-#{hook.id}"> <i class="fa fa-arrow-left me-1"></i> Back to Hook <t t-out="hook.hook_no"/></a>
                                                                <a class="btn btn-primary" t-attf-href="#ads-copy-images-#{ads.id}">View Images</a>
                                                                <a class="btn btn-primary" t-attf-href="#ads-copy-lp-#{ads.id}">View Landing Page</a>
                                                                <a class="btn btn-primary" t-attf-href="#ads-copy-video-#{ads.id}">View Video Script</a>
                                                            </div>
                                                        </section>
                                                    </t>
                                                </div>
                                            </t>
                                        </t>
                                    </t>
                                </t>
                            </div>

                            <h1>Ads Creatives</h1>
                            <!-- images -->
                            <div id="section-images" >
                                <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                    <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                        <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                            <t t-foreach="angle.hook_ids" t-as="hook">
                                                <t t-foreach="hook.ads_copy_ids" t-as="ads">
                                                    <div t-attf-id="ads-copy-images-#{ads.id}">
                                                        <t t-foreach="ads.image_generator_ids" t-as="img">
                                                            <section class="adsuhu-section" t-attf-id="section-img-#{img.id}" style="scroll-margin-top: 6rem;">
                                                                <h2 class="adsuhu-section-title">Image: <t t-out="img.name"/></h2>
                                                                <div class="adsuhu-content" t-if="img.output_html" t-raw="img.output_html"></div>

                                                                <div class="row" t-attf-id="section-image-variants-#{img.id}">
                                                                    <div class="col-md-6 gap-2 mb-2" t-foreach="img.image_variant_ids" t-as="iv">
                                                                        <a t-att-href="iv.image_url" target="_new">
                                                                            <img t-att-src="iv.image_url_512" class="img-fluid"/>
                                                                        </a>                                                                        
                                                                    </div>

                                                                    <div class="col-md-6 gap-2 mb-2" id="generating_image" style="background-color: #eee; display:none">
                                                                        <img src="/vit_adsuhu_frontend/static/src/img/loading.gif" class="img-fluid" style="height:400px;"/>
                                                                    </div>
                                                                </div>

                                                                <div class="d-flex align-items-center justify-content-center">
                                                                    <a class="btn btn-primary" t-attf-href="#section-ads-#{ads.id}">
                                                                        <i class="fa fa-arrow-left me-1"></i> Back to Ads Copy <t t-out="ads.name"/>
                                                                    </a>

                                                                    <button 
                                                                    class="btn btn-secondary js-regenerate" 
                                                                    id="image_variants" 
                                                                    t-att-data-id="img.id" 
                                                                    data-regenerate="image_variants" 
                                                                    t-attf-data-target-section="section-image-variants-#{img.id}">
                                                                        <i class="fa fa-send me-1"></i> Generate Images
                                                                    </button>
                                                                </div>  
                                                            </section>
                                                        </t>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                    </t>
                                </t>
                            </div>

                            <h1>Landing Pages</h1>
                            <!-- landing pages -->
                            <div id="section-landing-page" >
                                <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                    <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                        <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                            <t t-foreach="angle.hook_ids" t-as="hook">
                                                <t t-foreach="hook.ads_copy_ids" t-as="ads">
                                                    <div t-attf-id="ads-copy-lp-#{ads.id}">
                                                        <t t-foreach="ads.landing_page_builder_ids" t-as="lp">
                                                            <section class="adsuhu-section" t-attf-id="section-lp-#{lp.id}" style="scroll-margin-top: 6rem;">
                                                                <h2 class="adsuhu-section-title">LP: <t t-out="lp.name"/></h2>
                                                                <div class="adsuhu-content" t-if="lp.output_html" t-raw="lp.output_html"></div>
                                                                
                                                                <div class="d-flex align-items-center justify-content-center">
                                                                    <a class="btn btn-primary" t-attf-href="#section-ads-#{ads.id}">
                                                                        <i class="fa fa-arrow-left me-1"></i> Back to Ads Copy <t t-out="ads.name"/>
                                                                    </a> 
                                                                </div>                                                               
                                                            </section>
                                                        </t>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                    </t>
                                </t>
                            </div>

                            <h1>Video Scripts</h1>
                            <!-- video scripts -->
                            <div id="section-video-script" >
                                <t t-foreach="analysis.market_mapper_ids" t-as="market">
                                    <t t-foreach="market.audience_profiler_ids" t-as="audience">
                                        <t t-foreach="audience.angle_hook_ids" t-as="angle">
                                            <t t-foreach="angle.hook_ids" t-as="hook">
                                                <t t-foreach="hook.ads_copy_ids" t-as="ads">
                                                    <div t-attf-id="ads-copy-video-#{ads.id}">
                                                        <t t-foreach="ads.video_director_ids" t-as="vid">
                                                            <section class="adsuhu-section" t-attf-id="section-vid-#{vid.id}" style="scroll-margin-top: 6rem;">
                                                                <h2 class="adsuhu-section-title">Video: <t t-out="vid.name"/></h2>
                                                                <div class="adsuhu-content" t-if="vid.output_html" t-raw="vid.output_html"></div>
                                                                <div class="d-flex align-items-center justify-content-center">
                                                                    <a class="btn btn-primary" t-attf-href="#section-ads-#{ads.id}">
                                                                        <i class="fa fa-arrow-left me-1"></i> Back to Ads Copy <t t-out="ads.name"/>
                                                                    </a> 
                                                                </div> 
                                                            </section>
                                                        </t>
                                                    </div>
                                                </t>
                                            </t>
                                        </t>
                                    </t>
                                </t>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="product_analysis_form" name="Product Analysis Form">
        <t t-set="analysis" t-value="analysis or False"/>
        <t t-set="is_edit" t-value="is_edit or False"/>
        <t t-set="form_action" t-value="is_edit and (f'/product_analysis/{analysis.id}/update') or '/product_analysis/submit'"/>
        <t t-set="cancel_href" t-value="is_edit and (f'/product_analysis/{analysis.id}') or '/product_analysis'"/>
        <h2 class="adsuhu-card-title text-center mb-4">
            <t t-if="is_edit">Edit Product Analysis</t>
            <t t-if="not is_edit">Create New Product Analysis</t>
        </h2>
        <form t-att-action="form_action" method="post" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            
            <div class="mb-3">
                <label for="product_name" class="form-label">Product Name</label>
                <input type="text" class="form-control" name="product_name" id="product_name" placeholder="Your great product name..." required="required" t-att-value="analysis.name if is_edit else ''"/>
            </div>

            <div class="mb-3">
                <label for="product_url" class="form-label">Product URL</label>
                <button type="button" class="btn btn-outline-secondary">Fetch Product</button>
                <input type="text" class="form-control" name="product_url" id="product_url" placeholder="e.g. https://shopee.co.id/..." required="required" t-att-value="analysis.product_url if is_edit else ''"/>
            </div>

            <div class="mb-3">
                <label for="target_market" class="form-label">Target Market</label>
                <input type="text" class="form-control" name="target_market" id="target_market" placeholder="e.g. Indonesia, South East Asia, etc..." required="required" t-att-value="analysis.target_market if is_edit else ''"/>
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Product Description</label>
                <t t-if="is_edit">
                    <button type="button" class="btn btn-outline-secondary" id="write_ai_btn" t-att-data-analysis-id="analysis.id">
                        Write Description
                    </button>
                    <div class="small text-muted mt-1" id="write_ai_status"></div>
                </t>
                <textarea class="form-control" name="description" id="description" rows="5" placeholder="Paste or type product description here..."><t t-esc="analysis.description if is_edit else ''"/></textarea>
            </div>

            <!--div class="mb-3">
                <label for="features" class="form-label">Key Features</label>
                <textarea class="form-control" name="features" id="features" rows="4" placeholder="List product features..."><t t-esc="analysis.features if is_edit else ''"/></textarea>
            </div-->

            <div class="mb-3">
                <label for="lang_id" class="form-label">Language</label>
                <select class="form-control" name="lang_id" id="lang_id">
                    <t t-foreach="langs" t-as="language_rec">
                        <option t-att-value="language_rec.id" t-att-selected="is_edit and analysis.lang_id and (language_rec.id == analysis.lang_id.id) or (not is_edit and language_rec.code == 'en_US')">
                            <t t-esc="language_rec.name"/>
                        </option>
                    </t>
                </select>
            </div>

            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary btn-lg">
                    <t t-if="is_edit">Save Changes</t>
                    <t t-if="not is_edit">Start Product Analyzer</t>
                </button>
                <a t-att-href="cancel_href" class="btn btn-outline-secondary">Cancel</a>
            </div>
        </form>
        <t t-if="is_edit">
            <script type="text/javascript">
                document.addEventListener("DOMContentLoaded", () =&gt; {
                    console.log('loaded')
                    const aiBtn = document.getElementById("write_ai_btn");
                    if (!aiBtn) {
                        return;
                    }
                    const form = aiBtn.closest("form");
                    const descField = form.querySelector("#description");
                    console.log('descField', descField)
                    const featuresField = form.querySelector("#features");
                    const langField = form.querySelector("#lang_id");
                    const csrfTokenInput = form.querySelector("input[name='csrf_token']");
                    const analysisId = aiBtn.dataset.analysisId;
                    const statusEl = document.getElementById("write_ai_status");

                    const setButtonState = (loading) =&gt; {
                        if (loading) {
                            aiBtn.dataset.originalText = aiBtn.innerText;
                            aiBtn.innerText = "Generating...";
                            aiBtn.disabled = true;
                        } else {
                            aiBtn.innerText = aiBtn.dataset.originalText || "Write Description";
                            aiBtn.disabled = false;
                        }
                    };

                    aiBtn.addEventListener("click", async () =&gt; {
                        if (!analysisId) {
                            return;
                        }
                        if (statusEl) statusEl.textContent = "Saving and generating...";
                        setButtonState(true);
                        try {
                            const formData = new FormData(form);
                            const saveResponse = await fetch(form.action, {
                                method: "POST",
                                body: formData,
                                credentials: "same-origin",
                                redirect: "follow",
                            });
                            if (!saveResponse.ok) {
                                throw new Error("Failed to save the record.");
                            }

                            const rpcResponse = await fetch(`/product_analysis/${analysisId}/write_with_ai`, {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                    "X-CSRFToken": csrfTokenInput ? csrfTokenInput.value : "",
                                },
                                body: JSON.stringify({}),
                                credentials: "same-origin",
                            });

                            if (!rpcResponse.ok) {
                                const errorText = await rpcResponse.text();
                                throw new Error(errorText || "AI generation failed.");
                            }

                            const rpcJson = await rpcResponse.json();
                            const updated = rpcJson || null;
                            if (updated) {
                                if (descField) descField.value = updated.result.description || "";
                                if (featuresField) featuresField.value = updated.result.features || "";
                                if (langField &amp;&amp; updated.result.lang_id) {
                                    langField.value = updated.result.lang_id[0];
                                }
                                if (statusEl) statusEl.textContent = "Description updated using AI.";
                            }
                        } catch (err) {
                            console.error(err);
                            if (statusEl) statusEl.textContent = err.message || "AI generation failed.";
                            alert(err.message || "Something went wrong while generating the description.");
                        } finally {
                            setButtonState(false);
                            setTimeout(() =&gt; {
                                if (statusEl) statusEl.textContent = "";
                            }, 4000);
                        }
                    });
                });
            </script>
        </t>
    </template>

    <template id="product_analysis_create_template" name="Create Product Analysis">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <section class="adsuhu-container">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-8">
                                <div class="adsuhu-card">
                                    <div class="adsuhu-card-body">
                                        <t t-call="vit_adsuhu_frontend.product_analysis_form">
                                            <t t-set="langs" t-value="langs"/>
                                            <t t-set="analysis" t-value="False"/>
                                            <t t-set="is_edit" t-value="False"/>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <template id="product_analysis_edit_template" name="Edit Product Analysis">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <section class="adsuhu-container">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-8">
                                <div class="adsuhu-card">
                                    <div class="adsuhu-card-body">
                                        <t t-call="vit_adsuhu_frontend.product_analysis_form">
                                            <t t-set="langs" t-value="langs"/>
                                            <t t-set="analysis" t-value="analysis"/>
                                            <t t-set="is_edit" t-value="True"/>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>
</odoo>
